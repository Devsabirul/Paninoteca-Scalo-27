<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>üçî Admin Dashboard</h2>
      <button id="logoutBtn" class="btn btn-danger">Logout</button>
    </div>

    <!-- Add Food Form -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Add / Edit Food</div>
      <div class="card-body">
        <form id="addFoodForm">
          <input type="hidden" id="foodId">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" id="foodName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Price (‚Ç¨)</label>
            <input type="number" class="form-control" id="foodPrice" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" id="foodCategory">
              <option>Hamburgers</option>
              <option>Panini</option>
              <option>Hot Dog</option>
              <option>Bevande</option>
              <option>Birre</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Image URL</label>
            <input type="text" class="form-control" id="foodImage" required>
          </div>
          <button type="submit" class="btn btn-success w-100" id="saveBtn">Add Food</button>
        </form>
      </div>
    </div>

    <!-- Food Table -->
    <div class="card mb-4">
      <div class="card-header bg-warning">Food Table</div>
      <div class="card-body">
        <table class="table table-bordered table-hover text-center">
          <thead>
            <tr>
              <th>Name</th>
              <th>Price (‚Ç¨)</th>
              <th>Category</th>
              <th>Image</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="foodTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Review Table -->
    <div class="card mb-5">
      <div class="card-header bg-info text-white">Review Table</div>
      <div class="card-body">
        <table class="table table-bordered table-hover text-center">
          <thead>
            <tr>
              <th>User</th>
              <th>Comment</th>
              <th>Rating</th>
            </tr>
          </thead>
          <tbody id="reviewTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBLJeiSWSw3T19etQ4jhnZwPZ0NS1a2VAg",
      authDomain: "paniniteca-7cc69.firebaseapp.com",
      projectId: "paniniteca-7cc69",
      storageBucket: "paniniteca-7cc69.firebasestorage.app",
      messagingSenderId: "224311129663",
      appId: "1:224311129663:web:c99cd681d6ae4ccec42a8a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // ‚úÖ Auth guard
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      }
    });

    // üîí Logout
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    // üßæ Add or Update Food
    document.getElementById("addFoodForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const foodId = document.getElementById("foodId").value;
      const name = document.getElementById("foodName").value;
      const price = document.getElementById("foodPrice").value;
      const category = document.getElementById("foodCategory").value;
      const image = document.getElementById("foodImage").value;

      if (foodId) {
        // ‚úèÔ∏è Update existing food
        await updateDoc(doc(db, "foods", foodId), { name, price, category, image });
        alert("‚úÖ Food updated!");
      } else {
        // ‚ûï Add new food
        await addDoc(collection(db, "foods"), { name, price, category, image });
        alert("‚úÖ Food added!");
      }

      e.target.reset();
      document.getElementById("saveBtn").textContent = "Add Food";
      document.getElementById("foodId").value = "";
      loadFoodTable();
    });

    // üçî Load Food Table
    async function loadFoodTable() {
      const table = document.getElementById("foodTableBody");
      table.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "foods"));
      querySnapshot.forEach((docSnap) => {
        const f = docSnap.data();
        const id = docSnap.id;
        table.innerHTML += `
          <tr>
            <td>${f.name}</td>
            <td>‚Ç¨${f.price}</td>
            <td>${f.category}</td>
            <td><img src="${f.image}" width="60" class="rounded"></td>
            <td>
              <button class="btn btn-sm btn-warning me-1" onclick="editFood('${id}', '${f.name}', '${f.price}', '${f.category}', '${f.image}')">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteFood('${id}')">Delete</button>
            </td>
          </tr>`;
      });
    }

    // ‚úèÔ∏è Edit Food
    window.editFood = function (id, name, price, category, image) {
      document.getElementById("foodId").value = id;
      document.getElementById("foodName").value = name;
      document.getElementById("foodPrice").value = price;
      document.getElementById("foodCategory").value = category;
      document.getElementById("foodImage").value = image;
      document.getElementById("saveBtn").textContent = "Update Food";
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    // üóëÔ∏è Delete Food
    window.deleteFood = async function (id) {
      if (confirm("Are you sure you want to delete this food item?")) {
        await deleteDoc(doc(db, "foods", id));
        alert("üóëÔ∏è Food deleted!");
        loadFoodTable();
      }
    };

    // ‚≠ê Load Reviews
    async function loadReviewTable() {
      const table = document.getElementById("reviewTableBody");
      table.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "reviews"));
      querySnapshot.forEach((docSnap) => {
        const r = docSnap.data();
        table.innerHTML += `
          <tr>
            <td>${r.user || "Anonymous"}</td>
            <td>${r.comment}</td>
            <td>${r.rating || "-"}</td>
          </tr>`;
      });
    }

    // Initial load
    loadFoodTable();
    loadReviewTable();
  </script>
</body>
</html>
